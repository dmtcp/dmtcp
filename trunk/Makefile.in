@SET_MAKE@
LN_S = @LN_S@
MKDIR_P = @MKDIR_P@
CC = @CC@

all: mtcp dmtcp
	($(MAKE) bin)

mtcp:
	(cd mtcp && $(MAKE) CC=$(CC))

dmtcp:
	(cd dmtcp && $(MAKE))

clean:
	(cd mtcp && $(MAKE) clean)
	(cd dmtcp && $(MAKE) clean)

distclean:
	(cd mtcp && $(MAKE) distclean)
	(cd dmtcp && $(MAKE) distclean)  
	rm -f Makefile config.log config.status bin/*

bin/% : dmtcp/src/%
	(cd bin && $(LN_S) ../$< $*)

bin/% : mtcp/%
	(cd bin && $(LN_S) ../$< $*)

bin: bin/dmtcp_coordinator bin/dmtcp_checkpoint bin/dmtcp_restart bin/dmtcphijack.so bin/mtcp.so bin/mtcp_restart
 
.PHONY: all mtcp dmtcp clean distclean bin

